var OTPflagCount = 1;
// Response from Recaptcha
var response = "";

function callback() {
    response = grecaptcha.getResponse();
    dataLayer.push({
        event: "reCaptcha",
        eventCategory: "reCaptcha",
        eventAction: "bot Attempt",
    });
}

function recaptchaExpired() {
    response = "";
}

$(document).ready(function () {
    var dformSubmitURL;
    var recaptchaUrl;
    var formData;
    var btnID;
    var succMsg;
    var errMsg;
    var customMsg;
    var redirectUrl;
    var utmSource;
    var utmMedium;
    var utmCampaign;
    var utmTerm;
    var utmContent;
    var utmObj = {};
    var requestUrl = window.location.href;
    var buttonClick = true;
    var submitRedirect;
    var ctaClickAna = "";
    var responseAna = "";
    var crmData;
    var crmLeads;
    var anaErrmSg = "";
    var clientID = "";
    var dealerCity = $("#campaignFormModal").attr("dealercityUrl");
    var methodContactFlag = 1;
    var futureContactFlag = 1;
    var newModaleAna = false;
    let myGDPRObject = {};

    function getRndInteger(min, max) {
        return Math.floor(Math.random() * (max - min)) + min;
    }

    /**
    |--------------------------------------------------
    | Pre-populate field code
    |--------------------------------------------------
    */

    $.ajax({
        url: $(document).find(".myUrlLoginUnique").attr("data-url"),
        type: "GET",
        success: function (res) {
            if (res.code == 200) {
                let fname = res.data.fName;
                let lname = res.data.lName;
                let fullname = fname + " " + lname;
                $("#fullname").val(fullname);
                $("#email").val(res.data.contactDetails.email);
                $("#phone").val(res.data.contactDetails.mobile.number);
            }
        },
        error: function (e) {},
    });

    var randomNum = getRndInteger(1000000, 10000000);


    /**
    |--------------------------------------------------
    | Utm code
    |--------------------------------------------------
    */
    $.urlParam = function (name) {
        var results = new RegExp("[?&]" + name + "=([^&#]*)").exec(
            window.location.href
        );
        if (results == null) {
            return null;
        } else {
            return decodeURI(results[1]) || 0;
        }
    };

    function getBrowserId() {
        var aKeys = ["MSIE", "Firefox", "Safari", "Chrome", "Opera"],
            sUsrAg = navigator.userAgent,
            nIdx = aKeys.length - 1;
        for (nIdx; nIdx > -1 && sUsrAg.indexOf(aKeys[nIdx]) === -1; nIdx--);
        return nIdx;
    }

    var num = getBrowserId();

    if (num != -1) {
        urlParams = new URLSearchParams(window.location.search);
        utmSource = urlParams.get("utm_source");
        utmMedium = urlParams.get("utm_medium");
        utmCampaign = urlParams.get("utm_campaign");
        utmTerm = urlParams.get("utm_term");
        utmContent = urlParams.get("utm_content");
        utmObj = {
            utm_source: utmSource,
            utm_medium: utmMedium,
            utm_campaign: utmCampaign,
            utm_term: utmTerm,
            utm_content: utmContent,
        };
        localStorage.setItem("campaignUtm", JSON.stringify(utmObj));
    } else if (num == -1) {
        utmSource = $.urlParam("utm_source");
        utmMedium = $.urlParam("utm_medium");
        utmCampaign = $.urlParam("utm_campaign");
        utmTerm = $.urlParam("utm_term");
        utmContent = $.urlParam("utm_content");
        utmObj = {
            utm_source: utmSource,
            utm_medium: utmMedium,
            utm_campaign: utmCampaign,
            utm_term: utmTerm,
            utm_content: utmContent,
        };
        localStorage.setItem("campaignUtm", JSON.stringify(utmObj));
    }

    function restrictText(arg) {
        $("input[name=" + arg + "]").on("input", function () {
            $("." + arg + "msg").hide();
            var length = parseInt($(this).attr("maxlength"), 10);
            var text = $("input[name=" + arg + "]").val();
            // var textRe = /^[a-zA-Z ]+$/;
            var textRe = /^[a-zA-ZÀ-ž ]+$/;
            if (!textRe.test(text) || text.length > length) {
                var fnamestr = text.substring(0, text.length - 1);
                $("input[name=" + arg + "]").val(fnamestr);
            }
        });
    }

    var dmsIntegration;
    $("[name='concern']")
        .parent()
        .parent()
        .parent()
        .parent()
        .addClass("d-none");
    $("[name='query']").on("click", function () {
        dmsIntegration = $(this)
            .children("option:selected")
            .attr("dms-integration-condition");
        if (dmsIntegration == "true") {
            $("[name='concern']")
                .parent()
                .parent()
                .parent()
                .parent()
                .removeClass("d-none");
        } else {
            $("[name='concern']")
                .parent()
                .parent()
                .parent()
                .parent()
                .addClass("d-none");
        }
    });

    $("input[type=text]").each(function () {
        var onlyalphabet = $(this).attr("data-only-alphabets");
        if (onlyalphabet == "true") {
            restrictText(this.name);
        }
    });
    var otpDFlagD = "false";
    OTPflagCount = 1;


    /**
    |--------------------------------------------------
    | Message dialogue
    |--------------------------------------------------
    */
    function showDialog(message, otpDFlag) {
        $("body").addClass("modal-open");
        $("#campaignFormModal").addClass("show");
        $("#campaignFormModal").attr("aria-hidden", "false");
        $('<div class="modal-backdrop fade show"><div>').insertAfter(
            "#campaignFormModal"
        );
        $("#message").html(message);
        $("#campaignFormModal").css("display", "block");
        otpDFlagD = otpDFlag;
        if (otpDFlag == "true") {
            $("#normalModalBtn").addClass("d-none");
            $("#verifyOTPModalBtn").removeClass("d-none");
        } else {
            $("#normalModalBtn").removeClass("d-none");
            $("#verifyOTPModalBtn").addClass("d-none");
        }
    }

    /**
    |--------------------------------------------------
    | OTP dialogue
    |--------------------------------------------------
    */
    function showFinalDialog(message, otpDFlag, leadId) {
        $("body").addClass("modal-open");
        $("#campaignFormModal").addClass("show");
        $("#campaignFormModal").attr("aria-hidden", "false");
        $('<div class="modal-backdrop fade show"><div>').insertAfter(
            "#campaignFormModal"
        );
        $("#message").html(message);
        $("#campaignFormModal").css("display", "block");
        otpDFlagD = otpDFlag;
        if (otpDFlag == "true") {
            $("#normalModalBtn").addClass("d-none");
            $("#verifyOTPModalBtn").removeClass("d-none");
        } else {
            $("#normalModalBtn").removeClass("d-none");
            $("#verifyOTPModalBtn").addClass("d-none");
        }
        $(document).on("click", ".close-modal-btn", function (e) {
            $("body").removeClass("modal-open");
            $("#campaignFormModal").removeClass("show");
            $("#campaignFormModal").attr("aria-hidden", "true");
            $("#campaignFormModal").css("display", "none");
            $(".modal-backdrop").remove();
            if(btnID) $(`#submitButton-${btnID}`).removeClass("disable-submit-cta");
            if (redirectUrl) {
                if (leadId) {
                    window.location.href = redirectUrl + "?id=" + leadId;
                } else {
                    window.location.href = redirectUrl;
                }
            }
            if (otpDFlagD == "true" && OTPflagCount == 1) {
                submitFlagWithVerify = false;
                dynamicSendOTP();
                OTPflagCount++;
            }
        });
    }

    $(document).on("click", ".close-modal-btn", function (e) {
        $("body").removeClass("modal-open");
        $("#campaignFormModal").removeClass("show");
        $("#campaignFormModal").attr("aria-hidden", "true");
        $("#campaignFormModal").css("display", "none");
        $(".modal-backdrop").remove();
        if(btnID) $(`#submitButton-${btnID}`).removeClass("disable-submit-cta");
        if (otpDFlagD == "true" && OTPflagCount == 1) {
            dynamicSendOTP();
            OTPflagCount++;
        }
    });

    //Motorcycle Question Radio
    let preferredTimeToPurchase = "";
    $(".custom-radio-mtr").each(function () {
        if ($(this).hasClass("active")) {
            preferredTimeToPurchase = $(this)?.children("input").val();
        }
    })
    $(".custom-radio-mtr").on("click", function() {
        $(".custom-radio-mtr").each(function () {
            if ($(this).hasClass("active")) {
                $(this).removeClass("active")
            }
        })
        $(this).toggleClass("active");
        preferredTimeToPurchase = $(this)?.children("input").val();
    });

    /**
    |--------------------------------------------------
    | File upload functions
    |--------------------------------------------------
    */
    // let myArray = {
    //     add_file: [],
    // };
    // let subArray = {
    //     ...myArray,
    // };
    // let docUploaded = {
    //     ...subArray,
    // };
    // let fileUploadUrl = $("[name='uploads']").attr("file-upload-url");
    // let fileUploadUrl = $(".chooseFile").attr("file-upload-url");
    // let fileSizeError = $(".chooseFile").attr("file-size-error");
    // let multipleFileError = $(".chooseFile").attr("multiple-file-error");
    // let fileCount = $(".chooseFile").attr("file-count");
    // let uploadText = $(".chooseFile").attr("upload-text");
    // let fileFormatError = $(".chooseFile").attr("file-format-error");
    // let maxSize = $(".chooseFile").attr("maxlength");
    // let myTypeChecker = [".pdf", ".docx", ".doc", ".txt", ".jpg", ".tiff", ".jpeg", ".png", ".heic", ".heif", ".jpeg2000",".jp2"];

    // function uploadFileStep3(keyData, filePath, formData) {
    //     $.ajax({
    //         url: fileUploadUrl + "?path=" + filePath,
    //         type: "GET",
    //         contentType: "application/x-www-form-urlencoded",
    //         success: function (res) {
    //             let fileData = res.data;
    //             if (res.code == 200) {
    //                 let blobPath = fileData.blobPath;
    //                 for (const [key, value] of Object.entries(docUploaded)) {
    //                     if (key == keyData) {
    //                         docUploaded[key].push(blobPath);
    //                         formData.append(key, blobPath)
    //                     }
    //                 }

                    
    //             }
    //         },
    //         error: function (error) {},
    //     });
    // }

    // function uploadFileStep2(myArray, formData) {
    //     $.ajaxPrefilter(function (options, originalOptions, jqXHR) {
    //         delete options.headers["authorization"];
    //     });
    //     for (const [key, value] of Object.entries(myArray)) {
    //         for (let i = 0; i < myArray[key].length; i++) {
    //             $.ajax({
    //                 url: myArray[key][i][1],
    //                 type: "PUT",
    //                 data: myArray[key][i][2],
    //                 processData: false,
    //                 contentType: false,
    //                 headers: {
    //                     "x-ms-blob-type": "BlockBlob",
    //                 },
    //                 success: function (res) {
    //                     uploadFileStep3(myArray[key][i][0], myArray[key][i][3], formData);
    //                 },
    //                 error: function (error) {},
    //             });
    //         }
    //     }
        
    //     finalSubmitFlag = true;
    // }

    // function uploadFileStep1(imageName, keyData, bodyData) {
    //     let data = {
    //         fileName: imageName,
    //     };
    //     $.ajax({
    //         url: fileUploadUrl,
    //         type: "POST",
    //         data: data,
    //         contentType: "application/x-www-form-urlencoded",
    //         success: function (res) {
    //             let fileData = res.data;
    //             if (res.code == 200) {
    //                 let uploadFileApi = fileData.uploadURL;
    //                 let filePath = fileData.filePath;
    //                 for (const [key, value] of Object.entries(myArray)) {
    //                     if (key == keyData) {
    //                         myArray[key].push([keyData, uploadFileApi, bodyData, filePath]);
    //                     }
    //                 }
    //             }
    //         },
    //         error: function (error) {},
    //     });
    // }

    // let myDataText = $("#noFile").text().trim();
    // $(".chooseFile").on("change", function () {
    //     let keyData = "add_file";
    //     myArray[keyData] = [];
    //     let myFileArr = $(this)[0].files;
    //     let sizeCount = 0;
    //     for (let i = 0; i < myFileArr.length; i++) {
    //         sizeCount += myFileArr[i].size;
    //     }
    //     var extCounter = 0;
    //     for (let j = 0; j < myFileArr.length; j++) {
    //         let myExt = myFileArr[j].name.substring(myFileArr[j].name.lastIndexOf("."));
    //         for (let i = 0; i < myTypeChecker.length; i++) {
    //             if (myTypeChecker[i] == myExt.toLowerCase()) {
    //                 extCounter += 1;
    //                 break;
    //             }
    //         }
    //     }
    //     if (myFileArr.length >= 1 && extCounter != myFileArr.length) {
    //         showDialog(fileFormatError, "");
    //         $("#noFile").text(myDataText);
    //         $(this).val("");
    //     } else {
    //         if (myFileArr.length > Number(fileCount)) {
    //             showDialog(multipleFileError, "");
    //             $("#noFile").text(myDataText);
    //             $(this).val("");
    //         } else {
    //             if (sizeCount > (Number(maxSize) * 1024 * 1024)) {
    //                 showDialog(fileSizeError, "");
    //                 $("#noFile").text(myDataText);
    //                 $(this).val("");
    //             } else {
    //                 // if (myFileArr.length == 1) {
    //                 //     $("#trackDaysUploadFile").attr("data-text", myFileArr[0].name);
    //                 // } else {
    //                 //     $("#trackDaysUploadFile").attr("data-text", myFileArr.length + " " + uploadText);
    //                 // }
    //                 for (let i = 0; i < myFileArr.length; i++) {
    //                     let fileName = myFileArr[i].name;
    //                     let bodyData = this.files[0];
    //                     uploadFileStep1(fileName, keyData, bodyData);
    //                 }
    //             }
    //         }
    //     }
    // });


    /**
    |--------------------------------------------------
    | Get Cookie function
    |--------------------------------------------------
    */
    function getAnaCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(";");
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == " ") {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }

    /**
    |--------------------------------------------------
    | Lead data
    |--------------------------------------------------
    */
    const rawData = {};
    const buttonID = $(".formData").attr("data-page-id");
    const isCaptureLeads = $(`#submitButton-${buttonID}`).attr("capture-leads"), 
        leadObj = {
            sourceHandle : $(`#submitButton-${buttonID}`).attr("source-handle"),
            secondarySourceChannel : $(`#submitButton-${buttonID}`).attr("secondary-source-channel"),
            platform : $(`#submitButton-${buttonID}`).attr("platform"),
            identifier : $(`#submitButton-${buttonID}`).attr("identifier"),
        }
    
    const sendLead = (formData, leadObj) => {
        if (isCaptureLeads === "true") {
            for (const lead in leadObj) {
                formData.append(lead, leadObj[lead]);
            };
        }
    }

    if (isCaptureLeads === "true") {
        formData = {
            append: function (key, value) {
                rawData[key] = value
            }
        }
    }


    $("form").each(function () {
        var buttonID = $(this).attr("data-page-id");
        $(".df-form" + buttonID + " .mymotorcycles").click(function () {
            if ($(this).attr("data-bike-price")) {
                var priceTxt = $(this).attr("data-bike-price").split(" ");
                var motoPrice = parseFloat(priceTxt[1], 10);
                var percent = parseInt(
                    $(".df-form" + buttonID + " .motoMinPrice").attr(
                        "data-percent"
                    ),
                    10
                );
                var minPrice = (motoPrice / 100) * percent;
                $(".df-form" + buttonID + " .motoMinPrice").attr(
                    "data-minPrice",
                    minPrice
                );
                $(".df-form" + buttonID + " .motoMinPrice").focusout(
                    function () {
                        var value = $(this).val();
                        var key = $(this).attr("name");
                        var crmKey = $(this).attr("crm-field");
                        var min = $(this).attr("data-minprice");
                        var minAmt = parseInt(min, 10);
                        var inAmt = parseInt(value, 10);
                        if (value == "" || inAmt < minAmt) {
                            var msg = $("." + key + "msg").text();
                            showDialog(msg, "");
                            checkFlag = false;
                            $(document).on("input", this, function () {
                                checkFlag = true;
                                $("." + key + "msg").addClass("d-none");
                            });
                            return false;
                        }
                    }
                );
            }
        });
        //
        $(document).on("click", "#submitButton-" + buttonID , function () {
            ctaClickAna = $(this).text().trim();
            let selectedCookie = getAnaCookie("_ga");
            try {
                clientID = ga.getAll()[0].get("clientId");
            } catch (err) {
                if (selectedCookie) {
                    clientID = selectedCookie.replace("GA1.2.", "");
                    clientID = selectedCookie.replace("GA1.1.", "");
                } else {
                    clientID = "";
                }
            }
            if (isCaptureLeads != "true") {
                formData = new FormData();
            }
            crmData = {};
            btnID = $(this).attr("btn-id");
            dformSubmitURL = $(".df-form" + btnID).attr(
                "data-attr-submitDForm"
            );
            recaptchaUrl = $("#reCaptcha").attr("data-url");
            var form_name = $(".df-form" + btnID).attr("data-form-name");
            var form_type = $(".df-form" + btnID).attr("data-form-category");
            var model_code = $(".df-form" + btnID).attr("data-model-code");
            if (model_code) {
                formData.append("modelCode", model_code);
                crmData["modelCode"] = model_code;
            }
            formData.append("category", form_type);
            formData.append("formName", form_name);
            crmData["campaignCode"] = form_type;
            //console.log("form type is " + form_type);

            var Url = $(".df-form" + btnID).attr("data-page-path");
            if (Url) {
                if (Url.includes("/content/royal-enfield")) {
                    redirectUrl = Url.split("/content/royal-enfield")[1] + "/";
                } else {
                    redirectUrl = Url;
                }
            }

            var form_id = $(".df-form" + btnID).attr("data-page-id");
            formData.append("form_id", form_id);
            var form_path = $(".df-form" + btnID).attr("data-form-path");
            formData.append("formPath", form_path);

            var damPath = $(".df-form" + btnID).attr("data-dam-path");
            if (damPath) {
                formData.append("damImagePath", damPath);
            }
            var leadDynamics = $(".df-form" + btnID).attr("lead-dynamics");
            if (dmsIntegration == "true") {
                formData.append("leadDynamics", dmsIntegration);
            } else if (leadDynamics) {
                formData.append("leadDynamics", leadDynamics);
            }
            submitRedirect = $(".df-form" + btnID).attr("submit-redirect");

            crmLeads = $(".df-form" + btnID).attr("crm-leads");

            var requireDataSrc = $(".df-form" + btnID).attr(
                "require-data-source"
            );
            var contryEmailObject;
            if (requireDataSrc == "true") {
                contryEmailObject = JSON.parse(
                    $(".df-form" + btnID).attr("contryEmailObject")
                );
            }
            succMsg = $(".df-form" + btnID).attr("data-success");
            errMsg = $(".df-form" + btnID).attr("data-error");
            customMsg = $(".df-form" + btnID).attr("data-custom");
            //var form = $("input[type=file]")[0].files[0];
            //var form = $(".df-form")[0];

            var checkFlag = false;
            var radioChk = true;
            // Integrated Global Warranty
            if ($('.desg-spac:visible').length > 0) {
                travels = [];

                $('.desg-spac:visible').each(function (index, element) {
                    let travel = {
                        country: $(element).find('.count-spac').text(),
                        entryCity: $(element).find('input[name="enter_city"]').val(),
                        entryDate: $(element).find('input[name="enter_date"]').val(),
                        exitCity: $(element).find('input[name="exit_city"]').val(),
                        exitDate: $(element).find('input[name="exit_date"]').val()
                    };
                    travels.push(travel);
                });
                formData.append("visitingCountry", travels)
            }
            //
            $(".df-form" + btnID + " .df").each(function () {
                if (!$(this).parent().parent().hasClass("d-none")) {
                    var checkVal = [];
                    var type = $(this).attr("type");
                    var mandatory = $(this).attr("data-validation-status");
                    if (mandatory == "true") {
                        if (type == "text") {
                            var minLen = $(this).attr("min");
                            var maxLen = $(this).attr("maxlength");
                            var key = $(this).attr("name");
                            var crmKey = $(this).attr("crm-field");
                            if (crmKey == undefined) {
                                crmKey = key;
                            }
                            var value = $(this).val().trim();
                            if (key == "email") {
                                var regex =
                                    /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                                if (value == "" || !regex.test(value)) {
                                    var msg = $("." + key + "msg")
                                        .text()
                                        .trim();
                                    showDialog(msg, "");
                                    responseAna = "Unsuccessful";
                                    submitAnalytics(
                                        ctaClickAna,
                                        responseAna,
                                        msg
                                    );
                                    checkFlag = false;
                                    $(document).on("input", this, function () {
                                        checkFlag = true;
                                    });
                                    return false;
                                } else {
                                    formData.append(key, value);
                                    crmData[crmKey] = value;

                                    //formData[key] = value;
                                    checkFlag = true;
                                }
                            } else if (
                                value.length >= minLen &&
                                value.length <= maxLen
                            ) {
                                formData.append(key, value);
                                crmData[crmKey] = value;
                                //formData[key] = value;
                                checkFlag = true;
                            } else if (value && key == "dob") {
                                formData.append(key, value);
                                crmData[crmKey] = value;
                                //formData[key] = value;
                                checkFlag = true;
                            } else {
                                var msg = $("." + key + "msg")
                                    .text()
                                    .trim();
                                showDialog(msg, "");
                                responseAna = "Unsuccessful";
                                submitAnalytics(ctaClickAna, responseAna, msg);
                                checkFlag = false;
                                $(document).on("input", this, function () {
                                    checkFlag = true;
                                    restrictText(this.id);
                                });
                                return false;
                            }
                        } else if (type == "select") {
                            var key = $(this).attr("name");
                            var crmKey = $(this).attr("crm-field");
                            var value = $(this).children("option:selected").text().trim();
                            var code = $(this).val();
                            if (code == "" || code == null) {
                                if (
                                    key == "city" &&
                                    $(".citySuggestion").attr(
                                        "city-suggestionbox"
                                    ) == "true"
                                ) {
                                    if (
                                        crmKey !== "" &&
                                        typeof crmKey !== "undefined"
                                    ) {
                                        crmData[crmKey] = value;
                                    }
                                    formData.append(key, value);
                                    formData.append(key + "Code", code);
                                } else if (
                                    $(this)
                                        .parent()
                                        .parent()
                                        .parent()
                                        .parent()
                                        .hasClass("d-none") &&
                                    $(this)
                                        .children("option:selected")
                                        .attr("dms-integration-condition") !=
                                        "true"
                                ) {
                                    // do nothing
                                } else {
                                    var msg = $("." + key + "msg")
                                        .text()
                                        .trim();
                                    showDialog(msg, "");
                                    responseAna = "Unsuccessful";
                                    submitAnalytics(
                                        ctaClickAna,
                                        responseAna,
                                        msg
                                    );
                                    checkFlag = false;
                                    $(document).on("click", this, function () {
                                        checkFlag = true;
                                    });
                                    if (
                                        crmKey !== "" &&
                                        typeof crmKey !== "undefined"
                                    ) {
                                        crmData[crmKey] = value;
                                    }

                                    return false;
                                }
                            } else {
                                //console.log(key + ":" + value);
                                if (key == "current_vehicle" && value == "Select Motorcycle"
                                ) {
                                    //console.log("not added motorcycle name");
                                }
                                if (code == "otherState") {
                                    if (otherStateVal != "" && otherStateVal != undefined) {
                                        formData.append("state", otherStateVal);
                                        if (otherCityVal != "" && otherCityVal != undefined) {
                                            formData.append("city", otherCityVal);
                                        } else {
                                            showDialog(otherCityErrMsg, "");
                                            responseAna = "Unsuccessful";
                                            submitAnalytics(ctaClickAna, responseAna, otherCityErrMsg);
                                            checkFlag = false;
                                            return false;
                                        }
                                    } else {
                                        showDialog(otherStateErrMsg, "");
                                        responseAna = "Unsuccessful";
                                        submitAnalytics(ctaClickAna, responseAna, otherCityErrMsg);
                                        checkFlag = false;
                                        return false;
                                    }
                                } else if (code == "otherCity") {
                                    if (otherCityVal != "" && otherCityVal != undefined) {
                                        formData.append("city", otherCityVal);
                                    } else {
                                        showDialog(otherCityErrMsg, "");
                                        responseAna = "Unsuccessful";
                                        submitAnalytics(ctaClickAna, responseAna, otherCityErrMsg);
                                        checkFlag = false;
                                        return false;
                                    }
                                } else if (key == "field_1") {
                                    if (value != "" && value != undefined && value != "Employment Type") {
                                        formData.append(key, value);
                                    } else {
                                        var msg = $("." + key + "msg").text().trim();
                                        showDialog(msg, "");
                                        responseAna = "Unsuccessful";
                                        submitAnalytics(ctaClickAna, responseAna, msg);
                                        checkFlag = false;
                                        return false;
                                    }
                                } else if (key == "country") {
                                    formData.append(key, value);
                                    // formData.append(key + "Code", code);
                                    if (crmKey !== "" && typeof crmKey !== "undefined") {
                                        crmData[crmKey] = value;
                                    }
                                } else {
                                    formData.append(key, value);
                                    formData.append(key + "Code", code);
                                    if (crmKey !== "" && typeof crmKey !== "undefined") {
                                        crmData[crmKey] = value;
                                    }
                                }
                                checkFlag = true;
                            }
                        } else if (type == "file") {
                            var key = $(this).attr("name");
                            let value = $(this).val();
                            var maxSize = parseInt($(this).attr("maxlength"));
                            let fileData = $(this)[0].files[0];
                            // var fileForm = new FormData($(".df-form")[0]);
                            // for (var pair of fileForm.entries()) {
                            //     if (pair[0] == key) {
                                if (value && fileData.size <= maxSize * 1024 * 1024) {
                                    // uploadFileStep2(myArray, formData)
                                    formData.append("add_file", fileData.name)
                                    checkFlag = true;
                                } else {
                                    var msg = $("." + key + "msg").text().trim();
                                    showDialog(msg, "");
                                    responseAna = "Unsuccessful";
                                    submitAnalytics(ctaClickAna, responseAna, msg);
                                    checkFlag = false;
                                    $(document).on("click",this,function () {
                                        checkFlag = true;
                                    });
                                    return false;
                                }
                                // }
                            // }
                        } else if (type == "modelDropdown") {
                            var key = $(this).attr("name");
                            var value = $(this).attr("value");
                            if (value == "empty") {
                                var msg = $("." + key + "msg")
                                    .text()
                                    .trim();
                                showDialog(msg, "");
                                responseAna = "Unsuccessful";
                                submitAnalytics(ctaClickAna, responseAna, msg);
                                checkFlag = false;
                                $(document).on("click", this, function () {
                                    checkFlag = true;
                                });
                                return false;
                            } else {
                                formData.append(key, value);
                                formData.append(
                                    "damImagePath",
                                    $(this).attr("mailerimage")
                                );
                                formData.append(
                                    "modelCode",
                                    $(this).attr("modelCode")
                                );
                                formData.append(
                                    "bikeModelName",
                                    $(this).attr("bikeModelName")
                                );
                                crmData["modelCode"] =
                                    $(this).attr("modelCode");
                                checkFlag = true;
                            }
                        } else if (type == "radio" && radioChk == true) {
                            var key = $(this).attr("name");
                            if (!$("input[name=" + key + "]:checked").val()) {
                                var msg = $("." + key + "msg")
                                    .text()
                                    .trim();
                                showDialog(msg, "");
                                responseAna = "Unsuccessful";
                                submitAnalytics(ctaClickAna, responseAna, msg);
                                checkFlag = false;
                                $(document).on("click", this, function () {
                                    checkFlag = true;
                                });
                                return false;
                            } else {
                                radioChk = false;
                                formData.append(
                                    $("input[name=" + key + "]:checked").attr(
                                        "name"
                                    ),
                                    $("input[name=" + key + "]:checked").val()
                                );
                                checkFlag = true;
                            }
                        } else if (type == "checkbox") {
                            var key = $(this).attr("name");
                            var value = $(this).val();
                            if (key == "Terms") {
                                if ($(this).prop("checked") == true) {
                                    checkFlag = true;
                                } else if ($(this).prop("checked") == false) {
                                    var msg = $("." + key + "msg")
                                        .text()
                                        .trim();
                                    showDialog(msg, "");
                                    responseAna = "Unsuccessful";
                                    submitAnalytics(
                                        ctaClickAna,
                                        responseAna,
                                        msg
                                    );
                                    checkFlag = false;
                                    $(document).on("click", this, function () {
                                        checkFlag = true;
                                    });
                                    return false;
                                }
                            } else if (key == "TermsC") {
                                if ($(this).prop("checked") == true) {
                                    checkFlag = true;
                                } else if ($(this).prop("checked") == false) {
                                    var msg = $("." + key + "msg")
                                        .text()
                                        .trim();
                                    showDialog(msg, "");
                                    responseAna = "Unsuccessful";
                                    submitAnalytics(
                                        ctaClickAna,
                                        responseAna,
                                        msg
                                    );
                                    checkFlag = false;
                                    $(document).on("click", this, function () {
                                        checkFlag = true;
                                    });
                                    return false;
                                }
                            } else {
                                if (!formData.has(key)) {
                                    $("." + key + ":checked").each(function () {
                                        checkVal.push($(this).val());
                                        checkFlag = true;
                                    });
                                    if (checkVal.length == 0) {
                                        var msg = $("." + key + "msg")
                                            .text()
                                            .trim();
                                        showDialog(msg, "");
                                        responseAna = "Unsuccessful";
                                        submitAnalytics(
                                            ctaClickAna,
                                            responseAna,
                                            msg
                                        );
                                        checkFlag = false;
                                        $(document).on(
                                            "click",
                                            key,
                                            function () {
                                                checkFlag = true;
                                            }
                                        );
                                        return false;
                                    } else {
                                        formData.append(key, checkVal);
                                    }
                                }
                            }
                        } else if (type == "number") {
                            var mobRegStr = /^\d{10}$/;
                            var regStr = $(this).attr("data-validation-regex");
                            var regex = new RegExp(regStr);
                            var key = $(this).attr("name");
                            var crmKey = $(this).attr("crm-field");
                            if (crmKey == undefined) {
                                crmKey = key;
                            }
                            var value = $(this).val();
                            if ($(this).hasClass("motoMinPrice")) {
                                var min = $(this).attr("data-minprice");
                                var minAmt = parseInt(min, 10);
                                var inAmt = parseInt(value, 10);
                                if (value == "" || inAmt < minAmt) {
                                    var msg = $("." + key + "msg")
                                        .text()
                                        .trim();
                                    showDialog(msg, "");
                                    responseAna = "Unsuccessful";
                                    submitAnalytics(
                                        ctaClickAna,
                                        responseAna,
                                        msg
                                    );
                                    checkFlag = false;
                                    $(document).on("input", this, function () {
                                        checkFlag = true;
                                        $("." + key + "msg").addClass("d-none");
                                    });
                                    return false;
                                } else {
                                    formData.append(key, value);
                                    checkFlag = true;
                                }
                            } else if (key == "mobile") {
                                if (value == "" || !mobRegStr.test(value)) {
                                    var msg = $("." + key + "msg")
                                        .text()
                                        .trim();
                                    showDialog(msg, "");
                                    responseAna = "Unsuccessful";
                                    submitAnalytics(
                                        ctaClickAna,
                                        responseAna,
                                        msg
                                    );
                                    checkFlag = false;
                                    return false;
                                } else {
                                    formData.append(key, value);
                                    checkFlag = true;
                                }
                            } else {
                                if (value == "" || !regex.test(value)) {
                                    var msg = $("." + key + "msg")
                                        .text()
                                        .trim();
                                    showDialog(msg, "");
                                    responseAna = "Unsuccessful";
                                    submitAnalytics(
                                        ctaClickAna,
                                        responseAna,
                                        msg
                                    );
                                    checkFlag = false;
                                    $(document).on("input", this, function () {
                                        checkFlag = true;
                                        $("." + key + "msg").addClass("d-none");
                                    });
                                    return false;
                                }
                                if (verifyNumber == "true" && key == "phone") {
                                    if (verified == false) {
                                        OTPflagCount = 1;
                                        let validMsg = $("#phone").attr(
                                            "data-verification-validation"
                                        );
                                        //showDialog(validMsg,"true");
                                        dynamicSendOTP();
                                        checkFlag = false;
                                        return false;
                                    } else {
                                        formData.append(key, value);
                                        formData.append(
                                            "mobileVerification",
                                            verified
                                        );
                                        formData.append(
                                            "callingCode",
                                            countryCode
                                        );
                                        checkFlag = true;
                                    }
                                } else {
                                    formData.append(key, value);
                                    if (
                                        crmKey !== "" &&
                                        typeof crmKey !== "undefined"
                                    ) {
                                        crmData[crmKey] = value;
                                    }
                                    checkFlag = true;
                                }
                            }
                        }
                    } else {
                        var key = $(this).attr("name");
                        if (type == "select") {
                            var value = $(this)
                                .children("option:selected")
                                .val();
                            if (!value) {
                                value = "";
                            }
                            var code = $(this).val();
                            if (!code) {
                                code = "";
                            }
                            //console.log(key + ":" + value);
                            if (
                                key == "current_vehicle" &&
                                value == "Select Motorcycle"
                            ) {
                                //console.log("not added motorcycle name");
                            }

                            if (key == "countryCode") {
                                crmData[key] = value;
                                formData.append(key, value);
                            } else if (key == "state" || key == "city") {
                                crmData[key] = value;
                                formData.append(key, value);
                                formData.append(key + "Code", code);
                            } else {
                                formData.append(key, value);
                                formData.append(key + "Code", code);
                            }
                            checkFlag = true;
                        } else if (type == "file") {
                            var maxSize = parseInt($(this).attr("maxlength"));
                            var fileForm = new FormData($(".df-form")[0]);
                            for (var pair of fileForm.entries()) {
                                if (pair[0] == key) {
                                    if (pair[1].size <= maxSize * 1024 * 1024) {
                                        formData.append(key, pair[1]);

                                        checkFlag = true;
                                        break;
                                    } else {
                                        var msg = $("." + key + "msg")
                                            .text()
                                            .trim();
                                        showDialog(msg, "");
                                        responseAna = "Unsuccessful";
                                        submitAnalytics(
                                            ctaClickAna,
                                            responseAna,
                                            msg
                                        );
                                        checkFlag = false;
                                        $(document).on(
                                            "click",
                                            this,
                                            function () {
                                                checkFlag = true;
                                            }
                                        );
                                        return false;
                                    }
                                }
                            }
                        } else if (type == "radio" && radioChk == true) {
                            radioChk = false;
                            var key = $(this).attr("name");
                            formData.append(
                                $("input[name=" + key + "]:checked").attr(
                                    "name"
                                ),
                                $("input[name=" + key + "]:checked").val()
                            );
                            checkFlag = true;
                        } else if (type == "text") {
                            var key = $(this).attr("name");
                            var crmKey = $(this).attr("crm-field");
                            if (crmKey == undefined) {
                                crmKey = key;
                            }
                            var value = $(this).val().trim();
                            if (value != undefined && value != "") {
                                formData.append(key, value);
                                crmData[crmKey] = value;
                                checkFlag = true;
                            }
                        } else if (
                            (type != "radio") & (type != "checkbox") &&
                            crmLeads != "true"
                        ) {
                            var value = $(this).val();
                            formData.append(key, value);
                            checkFlag = true;
                        } else if (type == "checkbox" && crmLeads != "true") {
                            var newKey = $(this).attr("crm-field");
                            if (
                                newKey != "donotphone" &&
                                newKey != "donotemail"
                            ) {
                                if ($(this).prop("checked") == true) {
                                    myGDPRObject[newKey] = true;
                                } else {
                                    myGDPRObject[newKey] = false;
                                }
                            } else if (
                                newKey == "donotphone" ||
                                newKey == "donotemail"
                            ) {
                                if ($(this).prop("checked") == true) {
                                    myGDPRObject[newKey] = false;
                                } else {
                                    myGDPRObject[newKey] = true;
                                }
                            }
                        } else if (type == "checkbox") {
                            if (crmLeads == "true") {
                                var crmKey = $(this).attr("crm-field");
                                if (
                                    crmKey != "donotphone" &&
                                    crmKey != "donotemail"
                                ) {
                                    if ($(this).prop("checked") == true) {
                                        crmData[crmKey] = true;
                                    } else {
                                        crmData[crmKey] = false;
                                    }
                                } else if (
                                    crmKey == "donotphone" ||
                                    crmKey == "donotemail"
                                ) {
                                    if ($(this).prop("checked") == true) {
                                        crmData[crmKey] = false;
                                    } else {
                                        crmData[crmKey] = true;
                                    }
                                }
                            } else if (!formData.has(key)) {
                                $("." + key + " :checked").each(function () {
                                    checkVal.push($(this).val());
                                    checkFlag = true;
                                });
                                formData.append(key, checkVal);
                            }
                        }
                    }
                }
            });

            var isdealerVersion =
                document.getElementsByClassName("dealerDropdown");
            var consentLength = document.getElementsByClassName("consents");
            let myDealerChecker = $("#dealerdropstate").attr(
                "dealer-listing-not-required"
            );
            if (checkFlag == true && $("#reCaptcha").length > 0 && !response) {
                const errMsg = $("#reCaptcha").attr("data-validate");
                showDialog(errMsg, "");
            }

            if (
                checkFlag == true &&
                (form_type == "motorcycleCampaign" ||
                    form_type == "internationalMotorcycleCampaign") &&
                isdealerVersion.length > 0
            ) {
                var panItem = JSON.parse(localStorage.getItem("panItem"));
                var state = $("#dealerdropstate option:selected").val();
                var city = $("#city option:selected").val();
                if (myDealerChecker != "true") {
                    var DealerID = $(
                        ".dealer-dropdown .active .dealerItemInput"
                    ).attr("value");
                } else {
                    var DealerID = $("#dealerdropstate").attr("dealer-code");
                }
                var storeName = $(
                    ".dealer-dropdown .active .dealerItemInput"
                ).attr("name");
                var storeAddress = $(
                    ".dealer-dropdown .active .dealerItemInput"
                ).attr("deleraddress");
                var storeEmail = $(
                    ".dealer-dropdown .active .dealerItemInput"
                ).attr("data-deleremail");
                var storeMobile = $(
                    ".dealer-dropdown .active .dealerItemInput"
                ).attr("data-dealercontactnumber");
                var motorcycleModelName = $(
                    ".Motorcycle-Campaign-Page-Properties"
                ).attr("motorcycle-modelName");

                if (state == "" && state != "otherState") {
                    showDialog(
                        $("#dealerdropstate").attr("data-valid-message"),
                        ""
                    );
                    anaErrmSg =
                        $("#dealerdropstate").attr("data-valid-message");
                    responseAna = "Unsuccessful";
                    submitAnalytics(ctaClickAna, responseAna, anaErrmSg);
                    checkFlag = false;
                    $(document).on("input", "#dealerdropstate", function () {
                        checkFlag = true;
                    });
                } else if (
                    $(".citySuggestion").attr("city-suggestionbox") != "true" &&
                    city == "" &&
                    state != "otherState"
                ) {
                    showDialog($("#city").attr("data-valid-message"), "");
                    anaErrmSg = $("#city").attr("data-valid-message");
                    responseAna = "Unsuccessful";
                    submitAnalytics(ctaClickAna, responseAna, anaErrmSg);
                    checkFlag = false;
                    $(document).on("input", "#city", function () {
                        checkFlag = true;
                    });
                } else if (
                    $(".citySuggestion").attr("city-suggestionbox") == "true" &&
                    $(".citySuggestion").val() == ""
                ) {
                    showDialog($(".citySuggestion").attr("invaild-data"), "");
                    anaErrmSg = $(".citySuggestion").attr("invaild-data");
                    responseAna = "Unsuccessful";
                    submitAnalytics(ctaClickAna, responseAna, anaErrmSg);
                    checkFlag = false;
                    $(document).on("click", ".dealerData", function () {
                        checkFlag = true;
                    });
                } else if (
                    DealerID == "" ||
                    (DealerID == undefined &&
                        state != "otherState" &&
                        city != "otherCity" &&
                        myDealerChecker != "true")
                ) {
                    showDialog(
                        $(".dealers-list").attr("data-valid-message"),
                        ""
                    );
                    anaErrmSg = $(".dealers-list").attr("data-valid-message");
                    responseAna = "Unsuccessful";
                    submitAnalytics(ctaClickAna, responseAna, anaErrmSg);
                    checkFlag = false;
                    $(document).on("click", ".dealerData", function () {
                        checkFlag = true;
                    });
                } else if (
                    consentLength.length > 0 &&
                    $("#communityactivities").prop("checked") == false &&
                    $("#promotionsnews").prop("checked") == false &&
                    $("#surveysandresearch").prop("checked") == false &&
                    $("#allpromotions").prop("checked") == false &&
                    futureContactFlag == 1
                ) {
                    $("#communityactivities").focus();
                    responseAna = "Unsuccessful";
                    let errMsg = $("#futureContactError").text().trim();
                    showDialog(errMsg, "");
                    submitAnalytics(ctaClickAna, responseAna, errMsg);
                    futureContactFlag++;
                    checkFlag = false;
                    $(document).on(
                        "click",
                        "#communityactivities,#promotionsnews,#surveysandresearch,#allpromotions",
                        function () {
                            checkFlag = true;
                        }
                    );
                } else {
                    for (var key in panItem) {
                        formData.append(key, panItem[key]);
                    }
                    // formData.append("state", state);
                    // formData.append("city", city);
                    if (!motorcycleModelName) {
                        motorcycleModelName = form_name;
                    }
                    if(preferredTimeToPurchase){
                        formData.append("preferred_time",preferredTimeToPurchase);
                    }
                    formData.append("storeName", storeName);
                    formData.append("storeAddress", storeAddress);
                    formData.append("storeEmail", storeEmail);
                    formData.append("storeMobile", storeMobile);
                    formData.append("dealer_code", DealerID);
                    formData.append("motorcycleModelName", motorcycleModelName);
                    crmData["preferredDealer"] = DealerID;
                    checkFlag = true;
                    buttonClick = true;
                }
            } else if (checkFlag == true && form_type == "preOwned") {
                var storeName = $(".formData").attr("data-storeName");
                var storeAddress = $(".formData").attr("data-address");
                var storeEmail = $(".formData").attr("data-email");
                var storeMobile = $(".formData").attr("data-mobile");
                formData.append("storeName", storeName);
                formData.append("storeAddress", storeAddress);
                formData.append("storeEmail", storeEmail);
                formData.append("storeMobile", storeMobile);
                checkFlag = true;
            } else if (
                checkFlag == true &&
                form_type == "rideSure" &&
                isdealerVersion.length > 0
            ) {
                var packageError = $("#accordion").attr("data-perror");
                var engineSelected = $("#dropdown1 option:selected").val();
                var motorcycleSelected = $("#dropdown2 option:selected").val();
                var packageSelected = $("#dropdown3 option:selected").val();
                var state = $("#dealerdropstate option:selected").val();
                var city = $("#city option:selected").val();
                if (myDealerChecker != "true") {
                    var DealerID = $(
                        ".dealer-dropdown .active .dealerItemInput"
                    ).val();
                } else {
                    var DealerID = $("#dealerdropstate").attr("dealer-code");
                }
                if (!packageSelected) {
                    showDialog(packageError, "");
                    responseAna = "Unsuccessful";
                    submitAnalytics(ctaClickAna, responseAna, packageError);
                    checkFlag = false;
                    $(document).on("change", "#dropdown3", function () {
                        checkFlag = true;
                    });
                } else if (state == "") {
                    showDialog(
                        $("#dealerdropstate").attr("data-valid-message"),
                        ""
                    );
                    anaErrmSg = $(".dealers-list").attr("data-valid-message");
                    responseAna = "Unsuccessful";
                    submitAnalytics(ctaClickAna, responseAna, anaErrmSg);
                    checkFlag = false;
                    $(document).on("input", "#dealerdropstate", function () {
                        checkFlag = true;
                    });
                } else if (
                    $(".citySuggestion").attr("city-suggestionbox") != "true" &&
                    city == ""
                ) {
                    showDialog($("#city").attr("data-valid-message"), "");
                    anaErrmSg = $("#city").attr("data-valid-message");
                    responseAna = "Unsuccessful";
                    submitAnalytics(ctaClickAna, responseAna, anaErrmSg);
                    checkFlag = false;
                    $(document).on("input", "#city", function () {
                        checkFlag = true;
                    });
                } else if (
                    $(".citySuggestion").attr("city-suggestionbox") == "true" &&
                    $(".citySuggestion").val() == ""
                ) {
                    showDialog($(".citySuggestion").attr("invaild-data"), "");
                    anaErrmSg = $(".citySuggestion").attr("invaild-data");
                    responseAna = "Unsuccessful";
                    submitAnalytics(ctaClickAna, responseAna, anaErrmSg);
                    checkFlag = false;
                    $(document).on("click", ".dealerData", function () {
                        checkFlag = true;
                    });
                } else if (
                    DealerID == "" ||
                    (DealerID == undefined && myDealerChecker != "true")
                ) {
                    showDialog(
                        $(".dealers-list").attr("data-valid-message"),
                        ""
                    );
                    anaErrmSg = $(".dealers-list").attr("data-valid-message");
                    responseAna = "Unsuccessful";
                    submitAnalytics(ctaClickAna, responseAna, anaErrmSg);
                    checkFlag = false;
                    $(document).on("click", ".dealerData", function () {
                        checkFlag = true;
                    });
                } else if (
                    consentLength.length > 0 &&
                    $("#communityactivities").prop("checked") == false &&
                    $("#promotionsnews").prop("checked") == false &&
                    $("#surveysandresearch").prop("checked") == false &&
                    $("#allpromotions").prop("checked") == false &&
                    futureContactFlag == 1
                ) {
                    $("#communityactivities").focus();
                    responseAna = "Unsuccessful";
                    let errMsg = $("#futureContactError").text().trim();
                    showDialog(errMsg, "");
                    submitAnalytics(ctaClickAna, responseAna, errMsg);
                    futureContactFlag++;
                    checkFlag = false;
                    $(document).on(
                        "click",
                        "#communityactivities,#promotionsnews,#surveysandresearch,#allpromotions",
                        function () {
                            checkFlag = true;
                        }
                    );
                } else {
                    formData.append("dealer_code", DealerID);
                    crmData["preferredDealer"] = DealerID;

                    var storeName = $(
                        ".dealer-dropdown .active .dealerItemInput"
                    ).attr("name");
                    var storeAddress = $(
                        ".dealer-dropdown .active .dealerItemInput"
                    ).attr("deleraddress");
                    var storeEmail = $(
                        ".dealer-dropdown .active .dealerItemInput"
                    ).attr("data-deleremail");
                    var storeMobile = $(
                        ".dealer-dropdown .active .dealerItemInput"
                    ).attr("data-dealercontactnumber");
                    formData.append("storeName", storeName);
                    formData.append("storeAddress", storeAddress);
                    formData.append("storeEmail", storeEmail);
                    formData.append("storeMobile", storeMobile);
                    formData.append("field_1", engineSelected);
                    formData.append("field_2", motorcycleSelected);
                    formData.append("field_3", packageSelected);
                    checkFlag = true;
                    buttonClick = true;
                }
            } else if (
                checkFlag == true &&
                isdealerVersion.length > 0 &&
                selectState != "otherState" &&
                selCity != "otherCity"
            ) {
                var state = $("#dealerdropstate option:selected").val();
                var city = $("#city option:selected").val();
                if (myDealerChecker != "true") {
                    var DealerID = $(
                        ".dealer-dropdown .active .dealerItemInput"
                    ).val();
                } else {
                    var DealerID = $("#dealerdropstate").attr("dealer-code");
                }
                if (state == "") {
                    showDialog(
                        $("#dealerdropstate").attr("data-valid-message"),
                        ""
                    );
                    anaErrmSg = $(".dealers-list").attr("data-valid-message");
                    responseAna = "Unsuccessful";
                    submitAnalytics(ctaClickAna, responseAna, anaErrmSg);
                    checkFlag = false;
                    $(document).on("input", "#dealerdropstate", function () {
                        checkFlag = true;
                    });
                } else if (
                    $(".citySuggestion").attr("city-suggestionbox") != "true" &&
                    city == ""
                ) {
                    showDialog($("#city").attr("data-valid-message"), "");
                    anaErrmSg = $("#city").attr("data-valid-message");
                    responseAna = "Unsuccessful";
                    submitAnalytics(ctaClickAna, responseAna, anaErrmSg);
                    checkFlag = false;
                    $(document).on("input", "#city", function () {
                        checkFlag = true;
                    });
                } else if (
                    $(".citySuggestion").attr("city-suggestionbox") == "true" &&
                    $(".citySuggestion").val() == ""
                ) {
                    showDialog($(".citySuggestion").attr("invaild-data"), "");
                    anaErrmSg = $(".citySuggestion").attr("invaild-data");
                    responseAna = "Unsuccessful";
                    submitAnalytics(ctaClickAna, responseAna, anaErrmSg);
                    checkFlag = false;
                    $(document).on("click", ".dealerData", function () {
                        checkFlag = true;
                    });
                } else if (
                    DealerID == "" ||
                    (DealerID == undefined && myDealerChecker != "true")
                ) {
                    showDialog(
                        $(".dealers-list").attr("data-valid-message"),
                        ""
                    );
                    anaErrmSg = $(".dealers-list").attr("data-valid-message");
                    responseAna = "Unsuccessful";
                    submitAnalytics(ctaClickAna, responseAna, anaErrmSg);
                    checkFlag = false;
                    $(document).on("click", ".dealerData", function () {
                        checkFlag = true;
                    });
                } else if (
                    consentLength.length > 0 &&
                    $("#communityactivities").prop("checked") == false &&
                    $("#promotionsnews").prop("checked") == false &&
                    $("#surveysandresearch").prop("checked") == false &&
                    $("#allpromotions").prop("checked") == false &&
                    futureContactFlag == 1
                ) {
                    $("#communityactivities").focus();
                    responseAna = "Unsuccessful";
                    let errMsg = $("#futureContactError").text().trim();
                    showDialog(errMsg, "");
                    submitAnalytics(ctaClickAna, responseAna, errMsg);
                    futureContactFlag++;
                    checkFlag = false;
                    $(document).on(
                        "click",
                        "#communityactivities,#promotionsnews,#surveysandresearch,#allpromotions",
                        function () {
                            checkFlag = true;
                        }
                    );
                } else {
                    // formData.append("state", state);
                    // formData.append("city", city);
                    formData.append("dealer_code", DealerID);
                    crmData["preferredDealer"] = DealerID;

                    var storeName = $(
                        ".dealer-dropdown .active .dealerItemInput"
                    ).attr("name");
                    var storeAddress = $(
                        ".dealer-dropdown .active .dealerItemInput"
                    ).attr("deleraddress");
                    var storeEmail = $(
                        ".dealer-dropdown .active .dealerItemInput"
                    ).attr("data-deleremail");
                    var storeMobile = $(
                        ".dealer-dropdown .active .dealerItemInput"
                    ).attr("data-dealercontactnumber");
                    formData.append("storeName", storeName);
                    formData.append("storeAddress", storeAddress);
                    formData.append("storeEmail", storeEmail);
                    formData.append("storeMobile", storeMobile);
                    if (form_type == "internationalBTR") {
                        formData.append("motorcycleModelName", form_name);
                        if(preferredTimeToPurchase){
                            formData.append("preferred_time",preferredTimeToPurchase)
                        }
                    }
                    checkFlag = true;
                    buttonClick = true;
                }
            } else if (checkFlag == true && form_type == "internationalBTR") {
                formData.append("motorcycleModelName", form_name);
                if(preferredTimeToPurchase){
                            formData.append("preferred_time",preferredTimeToPurchase)
                }
                checkFlag = true;
                if (
                    consentLength.length > 0 &&
                    $("#communityactivities").prop("checked") == false &&
                    $("#promotionsnews").prop("checked") == false &&
                    $("#surveysandresearch").prop("checked") == false &&
                    $("#allpromotions").prop("checked") == false &&
                    futureContactFlag == 1
                ) {
                    $("#communityactivities").focus();
                    responseAna = "Unsuccessful";
                    let errMsg = $("#futureContactError").text().trim();
                    showDialog(errMsg, "");
                    submitAnalytics(ctaClickAna, responseAna, errMsg);
                    futureContactFlag++;
                    checkFlag = false;
                    $(document).on(
                        "click",
                        "#communityactivities,#promotionsnews,#surveysandresearch,#allpromotions",
                        function () {
                            checkFlag = true;
                        }
                    );
                }
            } else if (
                checkFlag == true &&
                form_type == "financePage" &&
                $(".bikes_test_ride_select").length > 0
            ) {
                newModaleAna = true;
                formData.append(
                    "motorcycleModelName",
                    $(".bikes_test_ride_select").attr("bikeModelName")
                );
                checkFlag = true;
            } else if (checkFlag == true && form_type == "financePage") {
                formData.append("motorcycleModelName", form_name);
                checkFlag = true;
            } else if (checkFlag == true && form_type == "motorcycleCampaign") {
                formData.append("motorcycleModelName", form_name);
                checkFlag = true;
            } else if (
                checkFlag == true &&
                form_type == "internationalMotorcycleCampaign"
            ) {
                formData.append("motorcycleModelName", form_name);
                if(preferredTimeToPurchase){
                    formData.append("preferred_time",preferredTimeToPurchase);
                }
                checkFlag = true;
                if (
                    consentLength.length > 0 &&
                    $("#communityactivities").prop("checked") == false &&
                    $("#promotionsnews").prop("checked") == false &&
                    $("#surveysandresearch").prop("checked") == false &&
                    $("#allpromotions").prop("checked") == false &&
                    futureContactFlag == 1
                ) {
                    $("#communityactivities").focus();
                    responseAna = "Unsuccessful";
                    let errMsg = $("#futureContactError").text().trim();
                    showDialog(errMsg, "");
                    submitAnalytics(ctaClickAna, responseAna, errMsg);
                    futureContactFlag++;
                    checkFlag = false;
                    $(document).on(
                        "click",
                        "#communityactivities,#promotionsnews,#surveysandresearch,#allpromotions",
                        function () {
                            checkFlag = true;
                        }
                    );
                }
            } else if (form_type == "rideSure") {
                var packageError = $("#accordion").attr("data-perror");
                if (field1 == undefined) {
                    showDialog(packageError, "");
                    responseAna = "Unsuccessful";
                    submitAnalytics(ctaClickAna, responseAna, packageError);
                }
                if (
                    checkFlag == true &&
                    select1 != "" &&
                    select2 != "" &&
                    select3 != "" &&
                    select1 != undefined &&
                    select2 != undefined &&
                    select3 != undefined
                ) {
                    formData.append("field_1", select1);
                    formData.append("field_2", select2);
                    formData.append("field_3", select3);
                } else if (
                    checkFlag == true &&
                    field1 != undefined &&
                    field1 != ""
                ) {
                    formData.append("field_1", field1);
                    formData.append("field_2", field2);
                    formData.append("field_3", field3);
                    checkFlag = true;
                } else {
                    checkFlag = false;
                }
            }
            else if (checkFlag == true && form_type == "becomeDealer") {
                if (
                    consentLength.length > 0 &&
                    $("#communityactivities").prop("checked") == false &&
                    $("#promotionsnews").prop("checked") == false &&
                    $("#surveysandresearch").prop("checked") == false &&
                    $("#allpromotions").prop("checked") == false &&
                    futureContactFlag == 1
                ) {
                    $("#communityactivities").focus();
                    responseAna = "Unsuccessful";
                    let errMsg = $("#futureContactError").text().trim();
                    showDialog(errMsg, "");
                    submitAnalytics(ctaClickAna, responseAna, errMsg);
                    futureContactFlag++;
                    checkFlag = false;
                    $(document).on(
                        "click",
                        "#communityactivities,#promotionsnews,#surveysandresearch,#allpromotions",
                        function () {
                            checkFlag = true;
                        }
                    );
                }
            } else if (checkFlag == true && form_type == "stayUpdated") {
                var DealerID = $(
                    ".dealer-dropdown .active .dealerItemInput"
                ).attr("value");
                var storeName = $(
                    ".dealer-dropdown .active .dealerItemInput"
                ).attr("name");
                var storeAddress = $(
                    ".dealer-dropdown .active .dealerItemInput"
                ).attr("deleraddress");
                var storeEmail = $(
                    ".dealer-dropdown .active .dealerItemInput"
                ).attr("data-deleremail");
                var storeMobile = $(
                    ".dealer-dropdown .active .dealerItemInput"
                ).attr("data-dealercontactnumber");
                if (
                    consentLength.length > 0 &&
                    $("#communityactivities").prop("checked") == false &&
                    $("#promotionsnews").prop("checked") == false &&
                    $("#surveysandresearch").prop("checked") == false &&
                    $("#allpromotions").prop("checked") == false &&
                    futureContactFlag == 1
                ) {
                    $("#communityactivities").focus();
                    responseAna = "Unsuccessful";
                    let errMsg = $("#futureContactError").text().trim();
                    showDialog(errMsg, "");
                    submitAnalytics(ctaClickAna, responseAna, errMsg);
                    futureContactFlag++;
                    checkFlag = false;
                    $(document).on(
                        "click",
                        "#communityactivities,#promotionsnews,#surveysandresearch,#allpromotions",
                        function () {
                            checkFlag = true;
                        }
                    );
                } else if (
                    DealerID == undefined &&
                    $(".dealer-dropdown").length > 0
                ) {
                    showDialog(
                        $(".dealers-list").attr("data-valid-message"),
                        ""
                    );
                    anaErrmSg = $(".dealers-list").attr("data-valid-message");
                    responseAna = "Unsuccessful";
                    submitAnalytics(ctaClickAna, responseAna, anaErrmSg);
                    checkFlag = false;
                    $(document).on("click", ".dealerData", function () {
                        checkFlag = true;
                    });
                } else if (Object.keys(myGDPRObject).length > 0) {
                    formData.append("storeName", storeName);
                    formData.append("storeAddress", storeAddress);
                    formData.append("storeEmail", storeEmail);
                    formData.append("storeMobile", storeMobile);
                    formData.append("dealer_code", DealerID);
                    checkFlag = true;
                } else if (DealerID) {
                    formData.append("storeName", storeName);
                    formData.append("storeAddress", storeAddress);
                    formData.append("storeEmail", storeEmail);
                    formData.append("storeMobile", storeMobile);
                    formData.append("dealer_code", DealerID);
                }
            }

            if (checkFlag == true && buttonClick == true) {
                buttonClick = false;
                if (requireDataSrc == "true" && contryEmailObject) {
                    var keysArr = formData.keys();
                    for (var key of formData.keys()) {
                        if (key == "countryCode") {
                            for (var i = 0; i < contryEmailObject.length; i++) {
                                if (
                                    formData.get("countryCode") ==
                                    contryEmailObject[i].countryCode
                                ) {
                                    formData.append(
                                        "mailTo",
                                        contryEmailObject[i].mailTo
                                    );
                                    formData.append(
                                        "mailCC",
                                        contryEmailObject[i].mailCC
                                    );
                                }
                            }
                        }
                    }
                }
                if (
                    $("#pincodeAutocomplete").length > 0 &&
                    $(".citySuggestion").length > 0 &&
                    $(".citySuggestion").attr("city-suggestionbox") == "true"
                ) {
                    var pincodeVal = $("#pincodeAutocomplete").val();
                    var pincodeSuggestionApi = $("#pincodeAutocomplete").attr(
                        "data-pincode-api"
                    );
                    var countryCodePincode = $("#pincodeAutocomplete").attr(
                        "country-code"
                    );
                    if (
                        countryCodePincode == undefined ||
                        countryCodePincode == null ||
                        countryCodePincode == ""
                    ) {
                        countryCodePincode = "in";
                    }
                    pincodeVal = pincodeVal.toUpperCase();
                    $.ajax({
                        url:
                            pincodeSuggestionApi +
                            "?pincode=" +
                            pincodeVal +
                            "&country=" +
                            countryCodePincode,
                        type: "GET",
                        success: function (res) {
                            if (res.code == 200) {
                                $(".loader-overlay").show();
                                formData.append("clientId", clientID);
                                var cityValueData = $(".citySuggestion").val();
                                $.ajax({
                                    url: dealerCity + "?city=" + cityValueData,
                                    type: "GET",
                                    success: function (res) {
                                        if (res.code == 200) {
                                            let sortedData = res.data;
                                            if (
                                                $(".citySuggestion").hasClass(
                                                    "citySuggestDealerdrop"
                                                )
                                            ) {
                                                formData.append(
                                                    "city",
                                                    cityValueData
                                                );
                                                crmData["city"] = cityValueData;
                                            }
                                            if (
                                                sortedData.includes(
                                                    cityValueData
                                                )
                                            ) {
                                                $(".loader-overlay").show();
                                                formData.append(
                                                    "clientId",
                                                    clientID
                                                );
                                                AjaxCall(formData);
                                            } else {
                                                buttonClick = true;
                                                showDialog(
                                                    $(".citySuggestion").attr(
                                                        "invaild-data"
                                                    ),
                                                    ""
                                                );
                                                anaErrmSg =
                                                    $(".citySuggestion").attr(
                                                        "invaild-data"
                                                    );
                                                responseAna = "Unsuccessful";
                                                submitAnalytics(
                                                    ctaClickAna,
                                                    responseAna,
                                                    anaErrmSg
                                                );
                                                $(".citySuggestion").val("");
                                            }
                                        } else if (res.code == 404) {
                                            buttonClick = true;
                                            showDialog(
                                                $(".citySuggestion").attr(
                                                    "invaild-data"
                                                ),
                                                ""
                                            );
                                            anaErrmSg =
                                                $(".citySuggestion").attr(
                                                    "invaild-data"
                                                );
                                            responseAna = "Unsuccessful";
                                            submitAnalytics(
                                                ctaClickAna,
                                                responseAna,
                                                anaErrmSg
                                            );
                                            $(".citySuggestion").val("");
                                        } else {
                                            buttonClick = true;
                                            showDialog(
                                                $(".citySuggestion").attr(
                                                    "invaild-data"
                                                ),
                                                ""
                                            );
                                            anaErrmSg =
                                                $(".citySuggestion").attr(
                                                    "invaild-data"
                                                );
                                            responseAna = "Unsuccessful";
                                            submitAnalytics(
                                                ctaClickAna,
                                                responseAna,
                                                anaErrmSg
                                            );
                                            $(".citySuggestion").val("");
                                        }
                                    },
                                    error: function (error) {
                                        showDialog(
                                            $(".citySuggestion").attr(
                                                "invaild-data"
                                            ),
                                            ""
                                        );
                                        anaErrmSg =
                                            $(".citySuggestion").attr(
                                                "invaild-data"
                                            );
                                        responseAna = "Unsuccessful";
                                        submitAnalytics(
                                            ctaClickAna,
                                            responseAna,
                                            anaErrmSg
                                        );
                                        $(".citySuggestion").val("");
                                    },
                                });
                            } else if (res.code == 404) {
                                buttonClick = true;
                                showDialog(
                                    $("#pincodeAutocomplete").attr(
                                        "data-pincode-validation"
                                    ),
                                    ""
                                );
                                anaErrmSg = $("#pincodeAutocomplete").attr(
                                    "data-pincode-validation"
                                );
                                responseAna = "Unsuccessful";
                                submitAnalytics(
                                    ctaClickAna,
                                    responseAna,
                                    anaErrmSg
                                );
                                $("#pincodeAutocomplete").val("");
                            } else {
                                buttonClick = true;
                                showDialog(
                                    $("#pincodeAutocomplete").attr(
                                        "data-pincode-validation"
                                    ),
                                    ""
                                );
                                anaErrmSg = $("#pincodeAutocomplete").attr(
                                    "data-pincode-validation"
                                );
                                responseAna = "Unsuccessful";
                                submitAnalytics(
                                    ctaClickAna,
                                    responseAna,
                                    anaErrmSg
                                );
                                $("#pincodeAutocomplete").val("");
                            }
                        },
                        error: function (error) {
                            showDialog(
                                $("#pincodeAutocomplete").attr(
                                    "data-pincode-validation"
                                ),
                                ""
                            );
                            anaErrmSg = $("#pincodeAutocomplete").attr(
                                "data-pincode-validation"
                            );
                            responseAna = "Unsuccessful";
                            submitAnalytics(
                                ctaClickAna,
                                responseAna,
                                anaErrmSg
                            );
                            $("#pincodeAutocomplete").val("");
                        },
                    });
                } else if ($("#pincodeAutocomplete").length > 0) {
                    var pincodeVal = $("#pincodeAutocomplete").val();
                    var pincodeSuggestionApi = $("#pincodeAutocomplete").attr(
                        "data-pincode-api"
                    );
                    var countryCodePincode = $("#pincodeAutocomplete").attr(
                        "country-code"
                    );
                    if (
                        countryCodePincode == undefined ||
                        countryCodePincode == null ||
                        countryCodePincode == ""
                    ) {
                        countryCodePincode = "in";
                    }
                    pincodeVal = pincodeVal.toUpperCase();
                    $.ajax({
                        url:
                            pincodeSuggestionApi +
                            "?pincode=" +
                            pincodeVal +
                            "&country=" +
                            countryCodePincode,
                        type: "GET",
                        success: function (res) {
                            if (res.code == 200) {
                                $(".loader-overlay").show();
                                formData.append("clientId", clientID);
                                AjaxCall(formData);
                            } else if (res.code == 404) {
                                buttonClick = true;
                                showDialog(
                                    $("#pincodeAutocomplete").attr(
                                        "data-pincode-validation"
                                    ),
                                    ""
                                );
                                anaErrmSg = $("#pincodeAutocomplete").attr(
                                    "data-pincode-validation"
                                );
                                responseAna = "Unsuccessful";
                                submitAnalytics(
                                    ctaClickAna,
                                    responseAna,
                                    anaErrmSg
                                );
                                $("#pincodeAutocomplete").val("");
                            } else {
                                buttonClick = true;
                                showDialog(
                                    $("#pincodeAutocomplete").attr(
                                        "data-pincode-validation"
                                    ),
                                    ""
                                );
                                anaErrmSg = $("#pincodeAutocomplete").attr(
                                    "data-pincode-validation"
                                );
                                responseAna = "Unsuccessful";
                                submitAnalytics(
                                    ctaClickAna,
                                    responseAna,
                                    anaErrmSg
                                );
                                $("#pincodeAutocomplete").val("");
                            }
                        },
                        error: function (error) {
                            showDialog(
                                $("#pincodeAutocomplete").attr(
                                    "data-pincode-validation"
                                ),
                                ""
                            );
                            anaErrmSg = $("#pincodeAutocomplete").attr(
                                "data-pincode-validation"
                            );
                            responseAna = "Unsuccessful";
                            submitAnalytics(
                                ctaClickAna,
                                responseAna,
                                anaErrmSg
                            );
                            $("#pincodeAutocomplete").val("");
                        },
                    });
                } else if (
                    $(".citySuggestion").length > 0 &&
                    $(".citySuggestion").attr("city-suggestionbox") == "true"
                ) {
                    var cityValueData = $(".citySuggestion").val();
                    $.ajax({
                        url: dealerCity + "?city=" + cityValueData,
                        type: "GET",
                        success: function (res) {
                            if (res.code == 200) {
                                let sortedData = res.data;
                                if (
                                    $(".citySuggestion").hasClass(
                                        "citySuggestDealerdrop"
                                    )
                                ) {
                                    formData.append("city", cityValueData);
                                    crmData["city"] = cityValueData;
                                }
                                if (sortedData.includes(cityValueData)) {
                                    $(".loader-overlay").show();
                                    formData.append("clientId", clientID);
                                    AjaxCall(formData);
                                } else {
                                    buttonClick = true;
                                    showDialog(
                                        $(".citySuggestion").attr(
                                            "invaild-data"
                                        ),
                                        ""
                                    );
                                    anaErrmSg =
                                        $(".citySuggestion").attr(
                                            "invaild-data"
                                        );
                                    responseAna = "Unsuccessful";
                                    submitAnalytics(
                                        ctaClickAna,
                                        responseAna,
                                        anaErrmSg
                                    );
                                    $(".citySuggestion").val("");
                                }
                            } else if (res.code == 404) {
                                if (
                                    $("#citySuggestion").attr(
                                        "city-text-field"
                                    ) == "true"
                                ) {
                                    formData.append("city", cityValueData);
                                    crmData["city"] = cityValueData;
                                    $(".loader-overlay").show();
                                    formData.append("clientId", clientID);
                                    AjaxCall(formData);
                                } else {
                                    buttonClick = true;
                                    showDialog(
                                        $(".citySuggestion").attr(
                                            "invaild-data"
                                        ),
                                        ""
                                    );
                                    anaErrmSg =
                                        $(".citySuggestion").attr(
                                            "invaild-data"
                                        );
                                    responseAna = "Unsuccessful";
                                    submitAnalytics(
                                        ctaClickAna,
                                        responseAna,
                                        anaErrmSg
                                    );
                                    $(".citySuggestion").val("");
                                }
                            } else {
                                if (
                                    $("#citySuggestion").attr(
                                        "city-text-field"
                                    ) == "true"
                                ) {
                                    formData.append("city", cityValueData);
                                    crmData["city"] = cityValueData;
                                    $(".loader-overlay").show();
                                    formData.append("clientId", clientID);
                                    AjaxCall(formData);
                                } else {
                                    buttonClick = true;
                                    showDialog(
                                        $(".citySuggestion").attr(
                                            "invaild-data"
                                        ),
                                        ""
                                    );
                                    anaErrmSg =
                                        $(".citySuggestion").attr(
                                            "invaild-data"
                                        );
                                    responseAna = "Unsuccessful";
                                    submitAnalytics(
                                        ctaClickAna,
                                        responseAna,
                                        anaErrmSg
                                    );
                                    $(".citySuggestion").val("");
                                }
                            }
                        },
                        error: function (error) {
                            if (
                                $("#citySuggestion").attr("city-text-field") ==
                                "true"
                            ) {
                                formData.append("city", cityValueData);
                                crmData["city"] = cityValueData;
                                $(".loader-overlay").show();
                                formData.append("clientId", clientID);
                                AjaxCall(formData);
                            } else {
                                showDialog(
                                    $(".citySuggestion").attr("invaild-data"),
                                    ""
                                );
                                anaErrmSg =
                                    $(".citySuggestion").attr("invaild-data");
                                responseAna = "Unsuccessful";
                                submitAnalytics(
                                    ctaClickAna,
                                    responseAna,
                                    anaErrmSg
                                );
                                $(".citySuggestion").val("");
                            }
                        },
                    });
                } else {
                $(".loader-overlay").show();
                formData.append("clientId", clientID);
                AjaxCall(formData);
                }
            }
        });
    });

    const SalesforceCdp = (email, phone) => {
        SalesforceInteractions.sendEvent({
            interaction: {
                name: "Submitted Form " + $("head").attr("cdp-form-name"),
            },
            user: {
                identities: {
                    emailAddress: email,
                    phoneNumber: phone,
                },
            },
        });
    };


    function submisson(finalData, language, country, jwtToken) {
        const cdpCheck = $("head").attr("cdp-required");
        const pageCountryCode = window.location.pathname.split("/").filter((item) => item != "")[0];
        const pageLanguageCode = window.location.pathname.split("/").filter((item) => item != "")[1];
        let REGION_JSON_DATA, isCountryJsonRequired, countrySelected, regionSelected, submitAPI = "", jsonlanguage = pageLanguageCode, jsonCountryCode = pageCountryCode, defaultLanguage = "", defaultCountryCode = "";
        const countryElement = document.querySelector("#country");
        if(countryElement){
            REGION_JSON_DATA = JSON?.parse(document.querySelector("#country").getAttribute("region-json-data")),
                isCountryJsonRequired = document.querySelector("#country").getAttribute("is-country-json-require"),
                countrySelected = document.querySelector('#country').selectedOptions[0]?.textContent,
                regionSelected = document.querySelector('#country').selectedOptions[0]?.getAttribute("region")?.toLowerCase();
        }
        // const rawFinalData = {}
        // if (isCaptureLeads === "true") {
        //     for (const pair of finalData.entries()) {
        //         rawFinalData[pair[0]] = pair[1];
        //     }
        // }
        sendLead(finalData, leadObj);
        if (isCountryJsonRequired == "true" && isCountryJsonRequired) {
            for (const key in REGION_JSON_DATA) {
                if (REGION_JSON_DATA[key]?.regionName?.toLowerCase() == regionSelected?.toLowerCase()) {
                    for(const i in REGION_JSON_DATA[key].countries) {
                        if (REGION_JSON_DATA[key]?.countries[i]?.country == "default") {
                            defaultLanguage = REGION_JSON_DATA[key]?.countries[i]?.countryLanguage;
                            defaultCountryCode = REGION_JSON_DATA[key]?.countries[i]?.countryCode;
                        }
                        if (REGION_JSON_DATA[key]?.countries[i]?.country?.toLowerCase() == countrySelected?.toLowerCase()) {
                            jsonlanguage = REGION_JSON_DATA[key]?.countries[i]?.countryLanguage;
                            jsonCountryCode = REGION_JSON_DATA[key]?.countries[i]?.countryCode;
                            break;
                        }
                    }
                    submitAPI = REGION_JSON_DATA[key]?.submitApi;
                }
            }
        }
        $.ajax({
            url: submitAPI == "" ? dformSubmitURL : submitAPI,
            type: "POST",
            data: isCaptureLeads === "true" ? JSON.stringify(rawData) : finalData,
            beforeSend: function (xhr) {
                xhr.setRequestHeader("x-custom-language", jsonlanguage ? jsonlanguage : defaultLanguage);
                xhr.setRequestHeader("x-custom-country", jsonCountryCode ? jsonCountryCode : defaultCountryCode);
                xhr.setRequestHeader("authorization", jwtToken);
                if (isCaptureLeads === "true") {
                    xhr.setRequestHeader("Content-Type", 'application/json');
                    xhr.setRequestHeader("contentType", 'application/json');
                    xhr.setRequestHeader("enctype", 'multipart/form-data');
                } else {
                    xhr.setRequestHeader("enctype", 'multipart/form-data');
                }
            },
            //data: alldata,
            processData: false,
            contentType: false,
            crossDomain: true,
            cache: false,
            // enctype: "multipart/form-data",
            // contentType: isCaptureLeads === "true" ? 'application/json' : "multipart/form-data",
            success: function (res) {
                if (res.success == true) {
                    if (cdpCheck === "true") {
                        SalesforceCdp($("input[name='email']").val(), $("input[name='phone']").val());
                    }
                    responseAna = "Successful";
                    submitAnalytics(ctaClickAna, responseAna, succMsg);
                    localStorage.removeItem("campaignUtm");
                    if (submitRedirect == true || submitRedirect == "true") {
                        if (isCaptureLeads === "true") {
                            if (res.data) {
                                window.location.href = redirectUrl + "?id=" + res.data;
                            } else {
                                window.location.href = redirectUrl + "?id=" + randomNum;
                            }
                        } else {
                            if (res.leadId) {
                                window.location.href = redirectUrl + "?id=" + res.leadId + "&show=" + res.data.pincodeCheckValue;
                            } else {
                                window.location.href = redirectUrl + "?id=" + randomNum+ "&show=" + res.data.pincodeCheckValue;
                            }
                        }
                        
                    } else {
                        showFinalDialog(succMsg, "", res.leadId);
                    }
                } else {
                    responseAna = "Unsuccessful";
                    submitAnalytics(ctaClickAna, responseAna, customMsg);
                    showDialog(customMsg, "");
                }
            },
            error: function (e) {
                buttonClick = true;
                showDialog(errMsg, "");
                responseAna = "Unsuccessful";
                submitAnalytics(ctaClickAna, responseAna, errMsg);
            },
        });
    }

    function AjaxCall(finalData) {
        var countryLang = "";
        var country = "";
        var language = "";
        var jwtToken = "";
        countryLang = $(".langCountryDiv").attr("data-langCountry");
        if (countryLang != undefined && countryLang != "") {
            country = countryLang.split("_")[0];
            language = countryLang.split("_")[1];
        }

        if (localStorage.getItem("jwtAccessToken") != null) {
            jwtToken = localStorage.getItem("jwtAccessToken");
        }

        if (localStorage.getItem("campaignUtm") != null) {
            var campaignUtmObj = JSON.parse(
                localStorage.getItem("campaignUtm")
            );
            for (var key in campaignUtmObj) {
                if (campaignUtmObj[key] != null) {
                    finalData.append(key, campaignUtmObj[key]);
                }
            }
        }

        if (crmLeads == "true") {
            console.log(crmData);
            crmData["country"] = country;
            finalData.append("crmData", JSON.stringify(crmData));
        } else if (Object.keys(myGDPRObject).length > 0) {
            finalData.append("crmData", JSON.stringify(myGDPRObject));
        }
        finalData.append("requestUrl", requestUrl);
        if($(`#submitButton-${buttonID}`).hasClass("disable-submit-cta")){
            return;
        }
        $(`#submitButton-${buttonID}`).addClass("disable-submit-cta");
        //console.log("=============", finalData);
        if ($("#reCaptcha").length > 0) {
            $.ajax({
                url: recaptchaUrl + "?recaptchaId=" + response,
                type: "GET",
                contentType: "application/json",
                success: function (recaptcharesult) {
                    if (recaptcharesult.success == true) {
                        submisson(finalData, language, country, jwtToken);
                    }
                },
                error: function () {},
            });
        } else {
            submisson(finalData, language, country, jwtToken);
        }
    }

    /**
    |--------------------------------------------------
    | GDPR concent function
    |--------------------------------------------------
    */
    function methodOfContact() {
        var mainObj = {};
        var methodOfContact = {};
        var consentData = {};
        $("input[type=checkbox]").each(function () {
            var crmKey = $(this).attr("crm-field");
            if (crmKey != undefined) {
                if (crmKey == "donotphone" || crmKey == "donotemail") {
                    if ($(this).prop("checked") == true) {
                        methodOfContact[crmKey] = "false";
                    }
                } else {
                    if ($(this).prop("checked") == true) {
                        consentData[crmKey] = "true";
                    }
                }
            }
        });
        mainObj.methodOfContact = methodOfContact;
        mainObj.consentData = consentData;
        return mainObj;
    }

    function submitAnalytics(ctaClick, submitMessage, validationAna) {
        let emailAna = $("[name='email']").val();
        localStorage.setItem("email", emailAna);
        let mobileAna = $("#phone").val();
        localStorage.setItem("mobile", mobileAna);
        let motorcycleModelName;
        let formCategoryGA = $(".df-form" + btnID).attr("data-form-category");
        console.log(formCategoryGA);
        if (
            formCategoryGA == "internationalMotorcycleCampaign" ||
            formCategoryGA == "motorcycleCampaign" ||
            formCategoryGA == "financePage" ||
            formCategoryGA == "internationalBTR"
        ) {
            motorcycleModelName = $(".df-form" + btnID).attr("data-form-name");
            if (!motorcycleModelName) {
                motorcycleModelName = "";
            }
            if ($(".bikes_test_ride_select").length > 0) {
                motorcycleModelName = $(".bikes_test_ride_select").attr(
                    "bikeModelName"
                );
                if (!motorcycleModelName) {
                    motorcycleModelName = "";
                }
            }
        } else {
            motorcycleModelName = "";
        }

        let dealerName = $(".dealer-dropdown .active .dealerItemInput").attr(
            "name"
        );
        if (dealerName == undefined) {
            dealerName = "";
        }
        let city = $("[name='city'] option:selected").text();
        let cityPlaceHolder = $(".citySuggestDealerdrop").attr("placeholder");
        if (city != cityPlaceHolder) {
            city = "";
            city = $(".citySuggestDealerdrop").val();
        }
        if (city == undefined) {
            city = $("[name='city'] option:selected").text();
        }
        let countryLang = $(".langCountryDiv").attr("data-langCountry");
        let country = "";
        if (countryLang != undefined && countryLang != "") {
            country = countryLang.split("_")[0];
        }
        let state = $("[name='state'] option:selected").text();
        if (!state) {
            state = "";
        }
        let typeOfQuery = $("[name='query'] option:selected").val();
        if (!typeOfQuery) {
            typeOfQuery = "";
        }
        let doYouOwnMotorCycle = $(
            "input[name='Motorcycle_owned']:checked"
        ).val();
        if (!doYouOwnMotorCycle) {
            doYouOwnMotorCycle = "";
        }
        let district = "";
        let howLongBusiness = "";
        let purchaseYear = $("[name='prefferred_time'] option:selected").val();
        if (!purchaseYear) {
            purchaseYear = "";
        }
        let exchangeMotorcycle = $(
            "[name='Motorcycle_owned'] option:selected"
        ).val();
        if (!exchangeMotorcycle) {
            exchangeMotorcycle = "";
        }

        let mainObj = methodOfContact();
        let count = 0;
        const methodOfContactValueList = Object.values(mainObj.methodOfContact);
        for (let i = 0; i < methodOfContactValueList.length; i++) {
            if (methodOfContactValueList[i] == "false") {
                count++;
            }
        }
        let doFlag = false;
        if (count == 2 && $("#gdpr-consent-form").hasClass("d-none")) {
            doFlag = true;
        }
        methodOfContactList = Object.keys(mainObj.methodOfContact);
        let communicationMethod = methodOfContactList.toString();
        communicationMethod = communicationMethod.replaceAll(",", "|");

        consentDataList = Object.keys(mainObj.consentData);
        let communicationInfoTopic = consentDataList.toString();
        communicationInfoTopic = communicationInfoTopic.replaceAll(",", "|");
        try {
            dataLayer.push({
                event: "campaignFormContainer",
                eventCategory: "campaignFormContainer",
                eventAction: ctaClick,
                eventLabel: submitMessage,
                errorMessage: validationAna,
                modelName: motorcycleModelName,
                dealerName: dealerName,
                city: city,
                country: country,
                state: state,
                queryType: typeOfQuery,
                motorcycleOwnership: doYouOwnMotorCycle,
                district: district,
                duration: howLongBusiness,
                communicationMethod: doFlag ? "" : communicationMethod,
                communicationInfoTopic: communicationInfoTopic,
                purchaseYear: purchaseYear,
                exchangeMotorcycle: exchangeMotorcycle,
            });
        } catch (err) {
            console.log("error");
        }
    }
});
